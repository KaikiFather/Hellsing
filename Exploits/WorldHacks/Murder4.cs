using HellsingPc.Misc;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using VRC;
using VRC.SDKBase;
using VRC.Udon;
using VRC.Udon.Common.Interfaces;
using static HellsingPc.Misc.Config;
namespace HellsingPc.Exploits.WorldHacks
{
    internal static class Murder4
    {
        
        public static void Murder4KillAll()
        {
            GameObject.Find("Game Logic").GetComponent<UdonBehaviour>().SendCustomNetworkEvent(0, "KillLocalPlayer");

        }

        public static void Murder4WinM()
        {
            GameObject.Find("Game Logic").GetComponent<UdonBehaviour>().SendCustomNetworkEvent(0, "SyncVictoryM");
        }

        public static void Murder4WinB()
        {
            GameObject.Find("Game Logic").GetComponent<UdonBehaviour>().SendCustomNetworkEvent(0, "SyncVictoryB");
        }

        public static void Murder4Start()
        {
            GameObject.Find("Game Logic").GetComponent<UdonBehaviour>().SendCustomNetworkEvent(0, "SyncStart");
        }

        public static void Murder4Abort()
        {
            GameObject.Find("Game Logic").GetComponent<UdonBehaviour>().SendCustomNetworkEvent(0, "SyncAbort");
        }

        public static void Murder4PosionWine()
        {
            GameObject.Find("Wine bottle").GetComponent<UdonBehaviour>().SendCustomNetworkEvent(0, "SyncApplyPoison");
        }

        public static void Luger()
        {
            var gameobject = GameObject.Find("Luger (0)");
            Networking.LocalPlayer.TakeOwnership(gameobject);
            gameobject.transform.position = Player.prop_Player_0.transform.position;

        }


        public static void Revolver()
        {
            var gameobject = GameObject.Find("Revolver");
            Networking.LocalPlayer.TakeOwnership(gameobject);
            gameobject.transform.position = Player.prop_Player_0.transform.position;

        }
        public static void Knife()
        {
            var gameobject = GameObject.Find("Knife (2)");
            Networking.LocalPlayer.TakeOwnership(gameobject);
            gameobject.transform.position = Player.prop_Player_0.transform.position;

        }
        public static void Beartrap()
        {
            var gameobject = GameObject.Find("Bear Trap (1)");
            Networking.LocalPlayer.TakeOwnership(gameobject);
            gameobject.transform.position = Player.prop_Player_0.transform.position;

        }

        public static void TeleportToBedroom()
        {
           Player.prop_Player_0.transform.position = new Vector3(-9.582809f, 3.565442f, 129.2488f);
        }
        #region Target
        public static void Murder4TargetKill()
        {
            TargeteEvent("SyncKill", IUserExtension.SelectedVRCPlayer());
            HellsingPc.Misc.LogHandler.Alert("[" + IUserExtension.SelectedVRCPlayer().field_Private_VRCPlayerApi_0.displayName + "] was killed");
        }

        public static void Murder4TargetFlash()
        {
            TargeteEvent("SyncFlashbang", IUserExtension.SelectedVRCPlayer());
            HellsingPc.Misc.LogHandler.Alert("[" + IUserExtension.SelectedVRCPlayer().field_Private_VRCPlayerApi_0.displayName + "] has been flashed");
        }

        public static void Murder4AssignB()
        {
            TargeteEvent("SyncAssignB", IUserExtension.SelectedVRCPlayer());
            HellsingPc.Misc.LogHandler.Alert("[" + IUserExtension.SelectedVRCPlayer().field_Private_VRCPlayerApi_0.displayName + "] is bystander now");
        }

        public static void Murder4AssignM()
        {
            TargeteEvent("SyncAssignM", IUserExtension.SelectedVRCPlayer());
            HellsingPc.Misc.LogHandler.Alert("[" + IUserExtension.SelectedVRCPlayer().field_Private_VRCPlayerApi_0.displayName + "] is murder now");
        }

        public static void Murder4AssignD()
        {
            TargeteEvent("SyncAssignD", IUserExtension.SelectedVRCPlayer());
            HellsingPc.Misc.LogHandler.Alert("[" + IUserExtension.SelectedVRCPlayer().field_Private_VRCPlayerApi_0.displayName + "] is detective now");
        }

        public static void Murder4FinishClues()
        {
            TargeteEvent("SyncCluesFinished", IUserExtension.SelectedVRCPlayer());
            HellsingPc.Misc.LogHandler.Alert("[" + IUserExtension.SelectedVRCPlayer().field_Private_VRCPlayerApi_0.displayName + "] has finished the clues");
        }

        public static void Murder4ExplodeTarget()
        {
            var gameobject = GameObject.Find("Frag (0)");
            Networking.LocalPlayer.TakeOwnership(gameobject);
            gameobject.transform.position = IUserExtension.SelectedVRCPlayer().transform.position;
            gameobject.GetComponent<UdonBehaviour>().SendCustomNetworkEvent(0, "Explode");
            HellsingPc.Misc.LogHandler.Alert("[" + IUserExtension.SelectedVRCPlayer().field_Private_VRCPlayerApi_0.displayName + "] is gone now");

        }

        public static IEnumerator Murder4LoopExplodeTarget()
        {
           
            var gameobject = GameObject.Find("Frag (0)");
            while (Murder4ExplodeLoop)
            {
                Networking.LocalPlayer.TakeOwnership(gameobject);
                gameobject.transform.position = IUserExtension.SelectedVRCPlayer().transform.position;
                gameobject.GetComponent<UdonBehaviour>().SendCustomNetworkEvent(0, "Explode");
                yield return new WaitForSeconds(0.5f);
            }
            yield break;
        }
        public static void TargeteEvent(string udonevent, Player player)
        {
            GameObject gameObject = GameObject.Find("Player Nodes");
            foreach (Transform componentsInChild in gameObject.GetComponentsInChildren<Transform>())
            {
                if (componentsInChild.name != gameObject.name)
                    componentsInChild.gameObject.Udonsend(udonevent, player);
            }
        }




        public static void Udonsend(this GameObject gameObject, string udonEvent, Player player = null, bool componetcheck = false)
        {
            UdonBehaviour component = gameObject.GetComponent<UdonBehaviour>();
            if (!(player != null))
            {
                if (componetcheck)
                    return;
                if (player == VRCPlayer.field_Internal_Static_VRCPlayer_0._player)
                    component.SendCustomEvent(udonEvent);
                else
                    component.SendCustomNetworkEvent(0, udonEvent);
            }
            else
            {
                gameObject.SetEventOwner(player);
                component.SendCustomNetworkEvent(NetworkEventTarget.Owner, udonEvent);
            }
        }
        public static void SetEventOwner(this GameObject gameObject, Player player)
        {
            if (!(gameObject.GrabOwner() != player))
                return;
            Networking.SetOwner(player.field_Private_VRCPlayerApi_0, gameObject);
        }

        public static Player GrabOwner(this GameObject gameObject)
        {
            foreach (Player player in PlayerManager.field_Private_Static_PlayerManager_0.field_Private_List_1_Player_0)
            {
                if (player.field_Private_VRCPlayerApi_0.IsOwner(gameObject))
                    return player;
            }
            return null;
        }
        #endregion

    }
}
